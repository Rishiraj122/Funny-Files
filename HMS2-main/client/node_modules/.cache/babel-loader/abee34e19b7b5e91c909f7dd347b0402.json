{"ast":null,"code":"var _jsxFileName = \"/Users/sherlock/Desktop/Actual Project/HMS2-main/client/src/components/MyBill.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport jwt from \"jsonwebtoken\";\nimport GooglePayButton from '@google-pay/button-react';\nimport HostelBill from \"./HostelBill\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction loadScript(src) {\n  return new Promise(resolve => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n\n    script.onload = () => {\n      resolve(true);\n    };\n\n    script.onerror = () => {\n      resolve(false);\n    };\n\n    document.body.appendChild(script);\n  });\n}\n\nconst MyBill = () => {\n  _s();\n\n  const history = useHistory();\n  const [messbill, setMessbill] = useState('');\n  const [hostelbill, setHostelbill] = useState('');\n  const [roll, setRoll] = useState('');\n  const [roomFee, setRoomFee] = useState('');\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      const user = jwt.decode(token);\n\n      if (!user) {\n        localStorage.removeItem('token');\n        history.replace('/login');\n      }\n\n      getBill();\n    } else {\n      history.push('/login');\n    }\n  });\n\n  const goBack = () => {\n    window.location.href = \"/studentdashboard\";\n  };\n\n  const getBill = () => {\n    const token = localStorage.getItem('token');\n    const user = jwt.decode(token);\n    fetch('http://localhost:1337/api/mybill').then(response => response.json()).then(json => {\n      for (let i = 0; i < json.user.length; i = i + 1) {\n        if (user.roll == json.user[i].roll) {\n          console.log(user.roll);\n          setRoll(user.roll);\n          setHostelbill(json.user[i].hostelbill);\n          setMessbill(json.user[i].messbill);\n        }\n      }\n    });\n  }; //For Hostel Fee Payment\n\n\n  async function showRazorpay() {\n    const res = await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");\n\n    if (!res) {\n      alert(\"Razorpay SDK failed to load. Are you online?\");\n      return;\n    }\n\n    const data = await fetch(\"http://localhost:1337/api/razorpay\", {\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        amount: hostelbill\n      })\n    }).then(t => t.json());\n    console.log(data);\n    const options = {\n      key: \"rzp_test_0tpemkHKm5K1Bc\",\n      currency: data.currency,\n      amount: roomFee * 100,\n      order_id: data.id,\n      name: \"Hostel Fees\",\n      description: \"Amount To Be Paid For Hostel Room Service\",\n      handler: function (response) {\n        // alert(response.razorpay_payment_id);\n        // alert(response.razorpay_order_id);\n        // alert(response.razorpay_signature);\n        deductAmount();\n\n        async function deductAmount(event) {\n          const response = await fetch('http://localhost:1337/api/billpayed', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              roomFee,\n              roll\n            })\n          });\n          const data = await response.json();\n\n          if (data.status == 'ok') {\n            alert(\"Fees Paid\");\n            window.location.href = \"mybill\";\n          }\n        }\n      },\n      prefill: {\n        name: \"Your Name\",\n        email: \"email@example.com\",\n        phone_number: \"1234567890\"\n      }\n    };\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n  } //For Mess Fee Payment Functions\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"My Bill\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"My Roll: \", roll]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Mess Bill: \", messbill]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Hostel Bill: \", hostelbill]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: goBack,\n      children: \"Go Back\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      children: \"Amount To Pay Now:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      type: \"number\",\n      placeholder: \"Enter Amount You Want To Pay For Hostel\",\n      value: roomFee,\n      onChange: e => setRoomFee(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: showRazorpay,\n      children: \"Room Fee\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 146,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MyBill, \"wVzui8rBdMCMaYAGSWCon69hFs8=\", false, function () {\n  return [useHistory];\n});\n\n_c = MyBill;\nexport default MyBill;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyBill\");","map":{"version":3,"sources":["/Users/sherlock/Desktop/Actual Project/HMS2-main/client/src/components/MyBill.js"],"names":["React","useEffect","useState","useHistory","jwt","GooglePayButton","HostelBill","loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","MyBill","history","messbill","setMessbill","hostelbill","setHostelbill","roll","setRoll","roomFee","setRoomFee","token","localStorage","getItem","user","decode","removeItem","replace","getBill","push","goBack","window","location","href","fetch","then","response","json","i","length","console","log","showRazorpay","res","alert","data","method","headers","JSON","stringify","amount","t","options","key","currency","order_id","id","name","description","handler","deductAmount","event","status","prefill","email","phone_number","paymentObject","Razorpay","open","e","target","value"],"mappings":"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","sourcesContent":["import React,{useEffect, useState} from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport jwt from \"jsonwebtoken\";\nimport GooglePayButton from '@google-pay/button-react';\nimport HostelBill from \"./HostelBill\";\n\n\nfunction loadScript(src) {\n    return new Promise((resolve) => {\n      const script = document.createElement(\"script\");\n      script.src = src;\n      script.onload = () => {\n        resolve(true);\n      };\n      script.onerror = () => {\n        resolve(false);\n      };\n      document.body.appendChild(script);\n    });\n  }\n  \n\n\nconst MyBill=()=>{\n    const history=useHistory();\n    const [messbill, setMessbill]=useState('');\n    const [hostelbill, setHostelbill]=useState('');\n    const [roll, setRoll]=useState('');\n    const [roomFee, setRoomFee]=useState('');\n\n    useEffect(()=>{\n        const token=localStorage.getItem('token');\n        if(token){\n            const user = jwt.decode(token)\n            if(!user){\n                localStorage.removeItem('token');\n                history.replace('/login')\n            }\n            getBill();\n        }\n        else{\n            history.push('/login')\n        }\n    })\n\n    const goBack=()=>{\n        window.location.href=\"/studentdashboard\"\n    }\n\n    const getBill=()=>{\n        const token = localStorage.getItem('token');\n        const user = jwt.decode(token)\n        fetch('http://localhost:1337/api/mybill',)\n        .then((response)=>response.json())\n        .then((json)=>{\n            for(let i=0;i<json.user.length;i=i+1){\n                if(user.roll==json.user[i].roll){\n                    console.log(user.roll);\n                    setRoll(user.roll);\n                    setHostelbill(json.user[i].hostelbill);\n                    setMessbill(json.user[i].messbill);\n                }\n            }\n\n        })\n    }\n\n\n\n    //For Hostel Fee Payment\n\n    async function showRazorpay() {\n        const res = await loadScript(\n          \"https://checkout.razorpay.com/v1/checkout.js\"\n        );\n    \n        if (!res) {\n          alert(\"Razorpay SDK failed to load. Are you online?\");\n          return;\n        }\n    \n        const data = await fetch(\"http://localhost:1337/api/razorpay\", {\n            method: \"POST\",\n            headers:{\n                'Content-Type':'application/json',\n            },\n                body: JSON.stringify({\n                    amount:hostelbill,\n            })\n        }).then((t) => t.json());\n    \n        console.log(data);\n    \n        const options = {\n          key: \"rzp_test_0tpemkHKm5K1Bc\",\n          currency: data.currency,\n          amount: roomFee*100,\n          order_id: data.id,\n          name: \"Hostel Fees\",\n          description: \"Amount To Be Paid For Hostel Room Service\",\n          handler: function (response) {\n            // alert(response.razorpay_payment_id);\n            // alert(response.razorpay_order_id);\n            // alert(response.razorpay_signature);\n            deductAmount();\n            async function deductAmount(event){\n                \n        \n                const response = await fetch('http://localhost:1337/api/billpayed',{\n                    method: 'POST',\n                    headers:{\n                        'Content-Type':'application/json',\n                    },\n                    body: JSON.stringify({\n                        roomFee,\n                        roll\n                    })\n                })\n        \n                const data = await response.json()\n        \n                if(data.status=='ok'){\n                    alert(\"Fees Paid\");\n                    window.location.href=\"mybill\"\n                }\n        \n            }\n\n          },\n          prefill: {\n            name: \"Your Name\",\n            email: \"email@example.com\",\n            phone_number: \"1234567890\",\n          },\n        };\n        const paymentObject = new window.Razorpay(options);\n        paymentObject.open();\n      }\n\n\n      //For Mess Fee Payment Functions\n\n\n\n    return(\n        <div>\n            <h1>My Bill</h1>\n            <p>My Roll: {roll}</p>\n            <p>Mess Bill: {messbill}</p>\n            <p>Hostel Bill: {hostelbill}</p>\n            <button onClick={goBack}>Go Back</button>\n\n            <div></div>\n            \n            <label>Amount To Pay Now:</label>\n            <input type=\"number\" placeholder=\"Enter Amount You Want To Pay For Hostel\" value={roomFee} onChange={(e)=>setRoomFee(e.target.value)}></input>\n            <div></div>\n            <button onClick={showRazorpay}>Room Fee</button>\n\n        </div>\n    )\n} \nexport default MyBill;"]},"metadata":{},"sourceType":"module"}